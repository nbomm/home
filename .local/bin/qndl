#!/bin/sh

# $1 is a url; $2 is a command
[ -z "$1" ] && exit
base="$(basename "$1")"
notify-send "â³ Queuing $base..."
cmd="$2"
#[ -z "$cmd" ] && cmd="yt-dlp --add-metadata -ic"
[ -z "$cmd" ] &&
	case "$1" in
		https://open.spotify*) cmd="spotdl --m3u" ;;
		https:/music.youtube.com*) cmd="yt-dlp --add-metadata -ic -x -f bestaudio/best" ;;
		*) cmd="yt-dlp --add-metadata -ic" ;;
	esac
idnum="$(tsp $cmd "$1")"
realname="$(echo "$base" | sed "s/?\(source\|dest\).*//;s/%20/ /g")"
tsp -D "$idnum" mv "$base" "$realname"
tsp -D "$idnum" notify-send "ğŸ‘ $realname done."
